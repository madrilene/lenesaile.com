---
title: 'Internacionalizaci√≥n con Eleventy 2.0 y Netlify'
description: "In this article, which I'm publishing along with my lightning talk at TheJam.dev 2023, I explain how internationalization works with my favorite tool Eleventy, building out a simple starter project."
category: blogpost
key: 'eleventyi18n'
date: 2023-01-25
lastEdit: 2023-04-10
---

Soy de Alemania, y ahora vivo y trabajo en Espa√±a. Mi vida cotidiana es triling√ºe, ya que el ingl√©s es el idioma en el que se desarrolla gran parte de mi actividad profesional.

Cuando hace unos meses rehice mi p√°gina web personal (¬°ah√≠ es donde est√°s ahora mismo!), se me ocurri√≥ la idea de que todo el contenido estuviera disponible en los tres idiomas. Si lo piensas bien, ¬°es realmente una contribuci√≥n a la accesibilidad!

Vale, digamos que al menos es un esfuerzo de _Dise√±o Inclusivo_. Como consecuencia natural, estoy aumentando mi alcance.

As√≠ que me puse manos a la obra. Y he aprendido mucho por el camino. Por ejemplo, nunca hab√≠a visto la cabecera `accept-language`, que indica el idioma natural y la configuraci√≥n regional que prefiere el usuario.

En este art√≠culo, que publico junto con mi [charla rel√°mpago en TheJam.dev 2023](https://cfe.dev/speakers/lene-saile/), explico c√≥mo se puede hacer una configuraci√≥n b√°sica para la internacionalizaci√≥n con [Eleventy](https://www.11ty.dev/).

Eleventy incluye un [plugin espec√≠fico para este prop√≥sito](https://www.11ty.dev/docs/plugins/i18n/) con la versi√≥n 2.0 que hace las cosas dif√≠ciles por nosotros en segundo plano.

Mi objetivo es construir un proyecto multiling√ºe de arranque, que sea lo m√°s simple y comprensible posible.

**¬°Comencemos!**

{% include "partials/toc.njk" %}

## Instalaci√≥n de Eleventy 2.0

Aseg√∫rate de que [tienes Node.js instalado](https://docs.npmjs.com/downloading-and-installing-node-js-and-npm) primero. Despu√©s de ejecutar `npm init`, obtendr√°s un archivo `package.json` que contendr√° metadatos sobre tu proyecto y registrar√° tus dependencias.

{% aside %}Si todo esto te suena cr√≠ptico, te recomiendo encarecidamente [esta serie para principiantes para npm](https://css-tricks.com/a-complete-beginners-guide-to-npm/) en CSS Tricks. Josh Comeau escribi√≥ una excelente gu√≠a sobre [c√≥mo usar la Terminal](https://www.joshwcomeau.com/javascript/terminal-for-js-devs/). {% endaside %}

Crea una nueva carpeta de proyecto, luego "cd" en ella. Yo he llamado a la m√≠a "eleventy-i18n-starter".

Para instalar Eleventy en tu proyecto, en la l√≠nea de comandos, ejecuta:

```node
npm install @11ty/eleventy --save-dev
```

¬°No necesitamos instalar nada m√°s! üéâ

## Ajustes b√°sicos

Primero, creamos un [Eleventy config file](/es/blog/estructuracion-del-archivo-de-configuracion-de-eleventy/). Aqu√≠ especificamos d√≥nde se encuentran nuestros archivos fuente, y c√≥mo debe llamarse nuestra carpeta de salida. Tambi√©n hago saber a Eleventy que usamos Nunjucks` como [lenguaje de plantilla](https://www.11ty.dev/docs/languages/) global por defecto para nuestros archivos markdown y HTML.

```js
module.exports = function (eleventyConfig) {
  return {
    dir: {
      input: 'src',
      output: 'dist'
    },
    markdownTemplateEngine: 'njk',
    htmlTemplateEngine: 'njk'
  };
};
```

A continuaci√≥n, crea la carpeta de entrada `src`, y en ella dos carpetas, llamadas `_data` (la necesitaremos m√°s adelante) e `_includes`. Dentro de `_includes` a√±ade un archivo llamado `base.njk`. Contiene nuestro "layout" principal:

`base.njk`:
{% raw %}

```html
<!DOCTYPE html>
<html lang="" dir="">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>{{ title }}</title>

    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/gh/kimeiga/bahunya/dist/bahunya.min.css"
    />

    <link rel="canonical" href="{{ meta.url }}{{ page.url }}" />
    <meta name="description" content="{{ description }}" />
  </head>

  <body>
    {% include "header.njk" %}
    <main>
      <h1>{{ title }}</h1>
      {{ content | safe }}
    </main>

    {% include "footer.njk" %}
  </body>
</html>
```

{% endraw %}

Para nuestro sencillo ejemplo, s√≥lo necesitamos un [layout](https://www.11ty.dev/docs/layouts/) que utilizamos para envolver todo el contenido.

S√≥lo he puesto algunos detalles muy b√°sicos y necesarios en la secci√≥n `head`.
La etiqueta `title` y la meta `description` ser√°n extra√≠das de nuestros archivos de plantilla markdown, para el estilo utilizo un framework CSS sin clases de 10KB en un CDN, ya que este art√≠culo no trata sobre CSS.

El landmark `main` contiene nuestro contenido, que es generado por archivos markdown. Para evitar que se llene demasiado, externalizo los puntos de referencia `header` y `footer` en layout partials.

A√±ade los parciales `header.njk` y `footer.njk` en la misma carpeta.
Por ahora, d√©jalos vac√≠os.

Para poder iniciar Eleventy con un comando r√°pido, a√±adimos el script CLI en la secci√≥n scripts del `package.json`.

`package.json`:

```js
  "scripts": {
    "start": "eleventy --serve --watch",
    "build": "eleventy"
  },
```

{% aside %}Para el comando `start` (desarrollo local) establezco los flags `--serve` (inicia el propio servidor de desarrollo por defecto de Eleventy) y `--watch` (vigila los cambios en los archivos). Hay m√°s flags disponibles: lee sobre [command line usage](https://www.11ty.dev/docs/usage/) en los docs de Eleventy.{% endaside %}

## Internacionalizaci√≥n y Localizaci√≥n

Antes de continuar, echemos un vistazo r√°pido a los t√©rminos internacionalizaci√≥n (tambi√©n conocido como "i18n") y localizaci√≥n ("l10n"), con los que inevitablemente te encontrar√°s.

### Localizaci√≥n

El objetivo de la localizaci√≥n es situar los contenidos en un contexto estructural y ling√º√≠sticamente correcto para una localizaci√≥n determinada.

Las localizaciones est√°n circunscritas por c√≥digos de idioma ISO, compuestos por un idioma base y el pa√≠s (territorio) de uso.
Tomando el alem√°n como ejemplo, existen los siguientes c√≥digos de localizaci√≥n:

`de`
: Alem√°n

`de-AT`
: Alem√°n (Austria)

`de-CH`
: Alem√°n (Suiza)

`de-DE`
: Alem√°n (Alemania)

`de-LI`
: Alem√°n (Liechtenstein)

`de-LU`
: Alem√°n (Luxemburgo)

Como parte del proceso de localizaci√≥n, hay que traducir el contenido, ajustar el tono de voz para adaptarlo a la cultura, a√±adir las divisas y unidades de medida utilizadas en esa regi√≥n o ajustar los elementos multimedia para que el mensaje se transmita correctamente en ese contexto cultural.

En el √°mbito de este art√≠culo nos preocupamos m√°s de la **internacionalizaci√≥n**.

### Internacionalizaci√≥n

Con la internacionalizaci√≥n _preparas_ tu c√≥digo para los requisitos de las diferentes localizaciones y todo el proceso de localizaci√≥n.

Por ejemplo, queremos asegurarnos de que los idiomas que se escriben de derecha a izquierda se manejen correctamente con CSS, o que los contenidos de texto de diferentes idiomas puedan ocupar diferentes cantidades de espacio sin romper el dise√±o. Las palabras alemanas pueden ser bastante largas.

Si quieres saber m√°s al respecto, aqu√≠ tienes algunas palabras largas en alem√°n.
Por alguna raz√≥n las he ido recopilando a lo largo de los a√±os.

<details>
<summary>Larga lista de palabras largas en alem√°n</summary>
<div lang="de" id="wordlist">

- Pfarrgemeinderatsmitglied
- Liegenschaftskataster
- Kunstfahndungsdienststelle
- Nichtregierungsorganisationen
- Mobilfunkanrufaufzeichnungen
- S√§belscheidenschienbein
- Strukturentwicklungszulagen
- nordwestmecklenburgisch
- Unabh√§ngigkeitsreferendum
- Junggesellinnenabschiedsparty
- Reiseschn√§ppchenportal
- Selbstverwirklichungsversprechen
- Unabh√§ngigkeitsbestrebungen
- Nachwuchsunternehmerin
- Desinformationskampagne
- Bundesprogrammkommission
- Hauptstadtb√ºroleiterin
- Altmedienbesitzstandswahrung
- Weltanschauungsvereinigungen
- aufmerksamkeits√∂konomisch
- Majest√§tsbeleidungsparagrafen
- Zweckentfremdungsverbot
- Suchmaschinenergebnisseiten
- Lebensmittelverteilungszentrum
- Rassekaninchenz√ºchterverein
- Bundespsychotherapeutenkammer
- Auslandsdirektinvestitionen
- Nachwuchsleistungszentren
- Wildwasserkajakstrecke
- Satellitenbeobachtungsprogramm
- Onlinelebensmittellieferdienst
- Jahresdurchschnittstemperaturen
- Androgenisierungserscheinungen
- Urananreicherungszentrum
- Senatsuntersuchungsausschuss
- Energieforschungskooperationen
- Antiglobalisierungstendenzen
- Renationalisierungstendenzen
- Eiskunstlaufenthusiastinnen
- Antikorruptionsstaatsanw√§ltin
- Selbstzerfleischungsprozess
- Unterbringungsm√∂glichkeiten
- Heimatschutzministerium
- Verkehrs√ºberwachungsma√ünahmen
- Geschwindigkeitsbegrenzungsschild
- Kunsthandwerkergenossenschaft
- Fruchstaftgetr√§nkehersteller
- Wahlkampffinanzierungsgesetze
- Unabh√§ngigkeitsbef√ºrworterin
- Vizepr√§sidentschaftskandidatin
- Geldw√§scheverdachtsmeldungen
</div>
 </details>

La internacionalizaci√≥n y la localizaci√≥n serias no son tarea f√°cil.

En mi p√°gina web personal (y en el √°mbito de este proyecto) me tomo la libertad de determinar que s√≥lo haya _un_ idioma ingl√©s o espa√±ol para todos los visitantes, as√≠ que todos mis lectores deben aguantarme mezclando alegremente el ingl√©s brit√°nico y el americano en ortograf√≠a y expresiones, porque no s√© hacerlo mejor.

Como en esta p√°gina web, utilizo el ingl√©s, el espa√±ol y el alem√°n para el proyecto inicial, simplemente porque s√© hablar estos idiomas y no me f√≠o de las traducciones autom√°ticas. De lo contrario, un lenguaje RTL, por supuesto, habr√≠a sido intrigante.

{% aside %}Por favor, si√©ntete libre de a√±adir m√°s idiomas v√≠a "pull request" al [proyecto starter que estamos creando](https://github.com/madrilene/eleventy-i18n), especialmente si es un idioma RTL.{% endaside %}

Empecemos a pensar en una estructura para nuestros tres idiomas.

## Patrones para URLs espec√≠ficas de la localizaci√≥n

Hay varios patrones para construir identificadores en las URLs.

Puedes optar por comprar dominios espec√≠ficos de un pa√≠s (`tuweb.de`), crear subdominios (`de.tuweb.com`), a√±adir par√°metros de URL (`tuweb.com?lang=de`) o crear subdirectorios localizados (`tuweb.com/de`).
Google Search Central ofrece [una tabla con algunos pros y contras](https://developers.google.com/search/docs/specialty/international/managing-multi-regional-sites#locale-specific-urls).

Eleventy compila bas√°ndose en la estructura de carpetas, por lo que los subdirectorios localizados funcionan perfectamente. Este es tambi√©n el procedimiento [recomendado por Eleventy](https://www.11ty.dev/docs/i18n/).

### Localizaci√≥n expl√≠cita e impl√≠cita

A continuaci√≥n, tenemos que considerar si queremos tener subdirectorios localizados _expl√≠citos_ o _impl√≠citos_. Es decir, ¬øqueremos un c√≥digo de localizaci√≥n de dos letras para _todos_ los idiomas en la URL (expl√≠cito), o debe mostrarse nuestro idioma principal en la URL sin un identificador (impl√≠cito)?

Ambas variantes son posibles. Si tienes un idioma primario muy claro en el sitio web y tal vez ni siquiera quieres traducir todos los contenidos, tiene sentido no mostrar un c√≥digo de idioma en la URL para tu idioma primario. En los [docs del plugin](https://www.11ty.dev/docs/i18n/#distinct-urls-using-implied-default-language) se explica c√≥mo se configura esto.

En mi sitio personal todo el contenido est√° traducido. Y aunque considero que el ingl√©s es el idioma principal, valoro los tres idiomas por igual. As√≠ que opt√© por el esquema expl√≠cito, y as√≠ es como queremos hacerlo tambi√©n en este proyecto starter.

## Creando la estructura de carpetas

Vamos a a√±adir tres carpetas, nombradas por el c√≥digo ISO de dos caracteres de cada idioma, y en cada una crearemos un archivo llamado `index.md`.

Nuestra estructura de carpetas tiene ahora este aspecto:
{% raw %}

<!-- prettier-ignore -->
```md
‚îÇ
‚îú‚îÄ‚îÄ src
‚îÇ  ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ _data
‚îÇ  ‚îú‚îÄ‚îÄ _includes
‚îÇ  ‚îú‚îÄ‚îÄ de
‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ index.md
‚îÇ  ‚îú‚îÄ‚îÄ en
‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ index.md
‚îÇ  ‚îú‚îÄ‚îÄ es
‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ index.md
‚îÇ
```

{% endraw %}

Pondremos algunos contenidos localizados en cada archivo:

**`en/index.md`:**

```md
---
title: 'English Page'
description: 'This is the english version of the homepage'
---

This is a minimal starter for localized content with Eleventy.
```

**`de/index.md`:**

```md
---
title: 'Deutsche Seite'
description: 'Dies ist die deutsche Version der Startseite'
---

Dies ist ein minimaler Starter f√ºr lokalisierte Inhalte mit Eleventy.
```

**`es/index.md`:**

```md
---
title: 'P√°gina en espa√±ol'
description: 'Esta es la versi√≥n en espa√±ol de la p√°gina inical'
---

Este es un starter m√≠nimo para contenido localizado con Eleventy.
```

Si no cambiamos la estructura de enlaces permanentes en Eleventy, tomar√° nuestra estructura de carpetas dentro del directorio de entrada tal cual. El archivo `index.md` es reconocido como la ra√≠z del directorio de idioma y transferido directamente como `index.html`.

A√±adamos una subp√°gina, la cl√°sica "sobre m√≠", y a√±adamos algunos contenidos localizados.

Llamo a esta p√°gina `about.md` en ambos idiomas. Esto tiene varias ventajas:

- El plugin i18n Eleventy reconoce las p√°ginas relacionadas
- odas las p√°ginas se muestran en el mismo orden
- Mantiene mi proyecto lo m√°s m√≠nimo y simple posible.

Si miramos en nuestra carpeta de salida, vemos que ahora se han creado tres nuevas subcarpetas, todas llamadas "about".

{% raw %}

<!-- prettier-ignore -->
```md
‚îÇ
‚îú‚îÄ‚îÄ dist
‚îÇ  ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ de
‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ index.html
‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ about
‚îÇ  ‚îÇ     ‚îî‚îÄ‚îÄ index.html
‚îÇ  ‚îú‚îÄ‚îÄ en
‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ index.html
‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ about
‚îÇ  ‚îÇ     ‚îî‚îÄ‚îÄ index.html
‚îÇ  ‚îú‚îÄ‚îÄ es
‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ index.html
‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ about
‚îÇ  ‚îÇ     ‚îî‚îÄ‚îÄ index.html
‚îÇ
```

{% endraw %}

Ten en cuenta que esta es la estructura final de nuestra p√°gina web, por lo que el enlace para la p√°gina "Sobre m√≠" en alem√°n ser√≠a: `www.mywebsite.com/de/about`.

### Slugs de URL localizadas

Prefiero que los idiomas sean coherentes entre s√≠. As√≠ que vamos a ajustar los permalinks.

**`de/about.md`:**

```md
---
title: '√úber mich'
description: 'Eine deutsche Unterseite'
permalink: /de/ueber-mich/index.html
---

Ich bin Webentwicklerin und Designerin, geboren in Berlin, zu Hause in Madrid.
```

Si quieres automatizar esto un poco m√°s y hacerlo m√°s intuitivo de usar, aqu√≠ hay una soluci√≥n inteligente que encontr√© en el [Eleventy Base Blog](https://github.com/11ty/eleventy-base-blog/tree/v2).

Tienes que a√±adir [Parent Directory Data Files](https://www.11ty.dev/docs/data-template-dir/) dentro de todas las subcarpetas localizadas.

Aqu√≠, pasas el idioma respectivo en el permalink y compruebas si hay una entrada de datos frontmatter opcional en tu plantilla, que se slugifica (¬øexiste esa palabra? üò∂).

**`es/es.11tydata.js`:**

```js
module.exports = {
  lang: 'es',
  permalink: function (data) {
    // Slug override for localized URL slugs
    if (data.slugOverride) {
      return `/${data.lang}/${this.slugify(data.slugOverride)}/`;
    }
  }
};
```

**`es/about.md`:**

```md
---
title: 'Sobre m√≠'
description: 'Una subp√°gina en espa√±ol'
slugOverride: sobre mi
---

Soy una desarrolladora y dise√±adora nacida en Berl√≠n, viviendo en Madrid.
```

En nuestro caso podr√≠amos simplemente slugificar el t√≠tulo, pero prefiero tratar estas cosas por separado, ya que puedo optar por ajustar el _string_ del t√≠tulo, manteniendo intacto el permalink.

### Separar el c√≥digo de la traducci√≥n

Para entender c√≥mo funciona todo esto es crucial que te sumerjas en [Eleventys Data Cascade](https://www.11ty.dev/docs/data-cascade/).

Siempre queremos ==separar el c√≥digo de la traducci√≥n==. Ya separamos el c√≥digo de los contenidos: nuestro c√≥digo vive en archivos de dise√±o (en este caso s√≥lo `base.njk`), y nuestros contenidos son creados por Markdown en archivos de plantilla. Tambi√©n necesitamos almacenar algunos _strings_ localizados para el dise√±o. _Podr√≠as_ almacenarlas en el Frontmatter del archivo de dise√±o, pero yo prefiero tener todo en un solo lugar.

¬°Los datos globales entran en juego!

## Datos globales

En la carpeta `_data` ponemos todo lo que queremos que est√© disponible globalmente en nuestro proyecto. V√°lidos son todos los valores `*.json` y `module.exports` de los archivos `*.js`.

Crea los siguientes ficheros de datos:

`meta.js`:

```js
// holds all our meta data
module.exports = {
  url: process.env.URL || 'http://localhost:8080',
  siteName: '18n-starter',
  siteDescription:
    "Minimal starter for localized content, using Eleventy's own Internationalization (I18n) plugin"
};
```

`languages.js`:

```js
// same locale codes as in your localized subdirectories
module.exports = {
  en: {
    dir: '', // stands for the direction of the language set in the head, defaults to LTR (left to right)
    availableText: 'This page is also available in:'
  },
  de: {
    availableText: 'Diese Seite ist auch verf√ºgbar in:'
  },
  es: {
    availableText: 'Esta p√°gina tambi√©n est√° disponible en:'
  }
};
```

`layout.js`:

```js
// sets a global layout for all templates, can be overwritten later in the Eleventy Data Cascade
module.exports = 'base.njk';
```

`navigation.js`:

```js
// just my personal preference for creating navigation in Eleventy
module.exports = {
  en: [
    {
      text: 'Home',
      url: '/en/'
    },
    {
      text: 'About me',
      url: '/en/about-me/'
    }
  ],
  de: [
    {
      text: 'Startseite',
      url: '/de/'
    },
    {
      text: '√úber mich',
      url: '/de/ueber-mich/'
    }
  ],
  es: [
    {
      text: 'Inicio',
      url: '/es/'
    },
    {
      text: 'Sobre mi',
      url: '/es/sobre-mi/'
    }
  ]
};
```

Siempre intento evitar complejidades innecesarias. Pongo todas mis strings localizados en mi carpeta de datos globales dentro de `languages.js`, y accedo a ellos usando "dot notation".

Si necesito m√°s strings localizados, los a√±ado all√≠. Lo mismo ocurre con la navegaci√≥n. Me gusta tener el m√°ximo control sobre qu√© p√°ginas muestro d√≥nde, y c√≥mo deber√≠an llamarse en el men√∫.

## Usando el plugin de internacionalizaci√≥n de Eleventy

Para activar el paquete i18n-Plugin, a√±√°delo a tu `eleventy.js`:

```js
const {EleventyI18nPlugin} = require('@11ty/eleventy');

module.exports = function (eleventyConfig) {
  eleventyConfig.addPlugin(EleventyI18nPlugin, {
    defaultLanguage: 'en' // Required
  });

  // other settings
};
```

Necesitamos especificar un idioma por defecto. Yo elijo el ingl√©s, pero puede ser cualquier idioma: `defaultLanguage: 'en'`

El plugin nos ofrece una adici√≥n a la [variable "page"](https://www.11ty.dev/docs/data-eleventy-supplied/#page-variable) (`page.lang`) as√≠ como dos nuevos [filtros universales](https://www.11ty.dev/docs/filters/#universal-filters) (`locale_url` y `locale_links`) para los "template languages" m√°s comunes.

Veamos primero `page.lang`.

### Uso de la etiqueta de idioma para la plantilla de p√°gina actual

`page.lang` representa la etiqueta de idioma para la plantilla de p√°gina actual, y por defecto tendr√° el valor que hayamos pasado como `defaultLanguage` en el plugin.

En primer lugar lo usamos para el atributo html `lang` y para acceder al valor de direcci√≥n (`dir`) que se puede establecer en `languages.js`.

`base.njk`:

{% raw %}

```html
<!DOCTYPE html>

<html lang="{{ page.lang }}" dir="{{ languages[page.lang].dir or 'ltr' }}">
  <!-- rest of the template -->
</html>
```

{% endraw %}

Toma tu nombre de directorio localizado y lo establece como el idioma del documento actual, y en caso del atributo `dir`, hace un bucle a trav√©s de `languages.js` en `_data` y obtiene la direcci√≥n correspondiente (RTL, o por defecto LTR).

**Esto es muy importante.**

El atributo `lang` se utiliza para definir el idioma de un elemento. ==Es utilizado por los lectores de pantalla para proporcionar el acento y la pronunciaci√≥n correctos==, el User Agent (tu browser) puede seleccionar las variantes correctas de glifos y comillas, separaci√≥n sil√°bica, ligaduras y espaciado.
Como todo en accesibilidad, tambi√©n beneficia a los motores de b√∫squeda.

{% aside %}Haciendo el [curso Learn Accessibility](https://web.dev/learn/accessibility/more-html/#page-language) aprend√≠ que es recomendable usar c√≥digos de lenguaje ISO de dos caracteres para una mayor cobertura de _Assistive technology_, ya que muchos de ellos no soportan c√≥digos de lenguaje extendidos.{% endaside %}

En este caso, definimos el idioma de todo el documento, pero tambi√©n se puede establecer el idioma en cualquier elemento, por ejemplo `<p lang="fr">Bonjour mon ami</p>`, _dentro_ de un documento que est√© escrito en otro idioma.

Ya lo he hecho antes con la lista de palabras en alem√°n. Imagina un lector de pantalla intentando leer en voz alta esta molesta lista cuando est√° configurado un idioma que no es el alem√°n.

A continuaci√≥n, lo utilizamos para nuestra navegaci√≥n en el punto de referencia `header` y como un simple conmutador de idioma en el landmark `footer`.

`header.njk`:

{% raw %}

```html
{% set activePage = page.url %}

<header>
  <nav aria-label="Primary">
    <ul>
      {% for item in navigation[page.lang] %}
      <li>
        <a href="{{ item.url }}">{{ item.text }}</a>
      </li>
      {% endfor %}
      <li>
        <a href="https://github.com/madrilene/eleventy-i18n">GitHub</a>
      </li>
    </ul>
  </nav>
</header>
```

{% endraw %}

Este parcial realiza un bucle a trav√©s de nuestro archivo de navegaci√≥n global, y bas√°ndose en el valor establecido por `page.lang`, muestra el men√∫ en el idioma actual.

{% aside %}En el proyecto final he incluido una [funci√≥n de ayuda](https://github.com/madrilene/eleventy-i18n/blob/main/src/_data/helpers.js) para a√±adir `aria-current="page"` a la p√°gina actual.
{% endaside %}

`footer.njk`:

{% raw %}

<!-- prettier-ignore -->
```html
<footer>
  {{ languages[page.lang].availableText }}

  {% for link in page.url | locale_links %} {%-if not loop.first %}/{% endif %}
  <a href="{{ link.url }}" lang="{{ link.lang }}" hreflang="{{ link.lang }}"
    >{{ link.label }}</a
  >
  {% endfor %}
</footer>
```

{% endraw %}

En el `footer` primero hacemos un bucle a trav√©s de `languages.js` para obtener el _string_ en el idioma actual, luego usamos el primero de los nuevos filtros universales disponibles: `locale_links`.

### Usando el filtro 'locale_links

`locale_links` devuelve un array con el contenido alternativo de una URL especificada. La p√°gina original pasada al filtro no se incluye en los resultados.
Haciendo un bucle a trav√©s de este array se obtiene un selector de idioma perfecto.

Tambi√©n puedes crear un selector de idioma con c√≥digos de localizaci√≥n de dos caracteres que muestre primero el idioma actual:

{% raw %}

<!-- prettier-ignore -->
```html
<!-- alternative language switcher -->
<footer>
  <nav>
    <a href="{{ page.url }}" lang="{{ page.lang }}" hreflang="{{ page.lang }}">
      {{ page.lang | upper }}
    </a>

    {% for link in page.url | locale_links %}
    <a href="{{ link.url }}" lang="{{ link.lang }}" hreflang="{{ link.lang }}">
      {{ link.lang | upper }}</a
    >
    {% endfor %}
  </nav>
</footer>
```

{% endraw %}

En el elemento `head` de `base.njk` hacemos saber al "user agent" que existen ==versiones alternativas del documento actual==. El atributo `hreflang` indica en qu√© idioma est√° el recurso enlazado.

{% aside %}[√Ålvaro Montoro](https://alvaromontoro.com/) escribi√≥ un [excelente art√≠culo sobre el atributo `rel`](https://www.htmhell.dev/adventcalendar/2022/21/#meta-types) en el HTMHell Advent Calendar editon 2022. {% endaside %}

Ten en cuenta que cada versi√≥n ling√º√≠stica debe listarse a s√≠ misma, as√≠ como todas las dem√°s versiones ling√º√≠sticas. [Las URL alternativas deben ser _completamente cualificadas_](https://developers.google.com/search/docs/specialty/international/localized-versions#all-method-guidelines), incluyendo el m√©todo de transporte - es decir `http` o `https`.

Primero a√±adimos el atributo "link" a la URL actual y, a continuaci√≥n, hacemos un bucle sobre las versiones alternativas.

`base.njk`:

{% raw %}

<!-- prettier-ignore -->
```html
<!-- stylesheet here -->

<link rel="alternate" hreflang="{{ page.lang }}" href="{{ meta.url }}{{ page.url }}" />

    {% for link in page.url | locale_links %}
    <link
      rel="alternate"
      hreflang="{{ link.lang }}"
      href="{{ meta.url }}{{ link.url }}"
    />
    {% endfor %}

<!-- Canonical URL here -->

```

{% endraw %}

Hay un filtro m√°s del que a√∫n no hemos hablado.

### Usando el filtro "locale_url"

En palabras de la documentaci√≥n de Eleventy, `locale_url` acepta cualquier _string_ de URL arbitrario y lo transforma usando la configuraci√≥n regional de la p√°gina actual. Funciona como se espera si la URL ya contiene un c√≥digo de idioma. Esto es muy √∫til en cualquier c√≥digo compartido usado por contenido internacionalizado (layouts, partials, includes, etc).

En nuestro proyecto inicial no lo necesitamos, pero imag√≠nese usarlo como un parcial de dise√±o para una _call to action_, enviando al visitante a la p√°gina localizada del blog, por ejemplo. La sintaxis es la siguiente:

{% raw %}

```html
<a href="{{ "/blog/" | locale_url }}">Blog</a>
```

{% endraw %}

Sin embargo, s√≥lo parece funcionar si no tocas los permalinks, por eso no lo estoy utilizando por ahora.

## M√°s ajustes de accesibilidad

Necesitamos hacer algunos ajustes importantes en t√©rminos de accesibilidad. Los puntos de referencia de navegaci√≥n (`nav`) deben tener una etiqueta, y estas etiquetas deben ser traducidas tambi√©n. Lo mismo ocurre con el enlace "saltar navegaci√≥n".
Ambos _strings_ pueden establecerse en `languages.js`.

Puedes encontrarlo implementado en el repositorio de GitHub para [`header.njk`](https://github.com/madrilene/eleventy-i18n/blob/main/src/_includes/header.njk) y [`languages.js`](https://github.com/madrilene/eleventy-i18n/blob/main/src/_data/languages.js).

## Redirigir al visitante a su directorio de idioma preferido

Antes de que podamos utilizar nuestro c√≥digo en un sitio en vivo, tenemos que ajustar un detalle muy importante.

Ahora mismo, obtenemos un 404 en la ra√≠z de la URL, ya que todav√≠a no estamos redirigiendo al visitante a su directorio de idioma preferido.

### ¬øC√≥mo se determina el idioma preferido?

Las redirecciones basadas en el idioma que vamos a configurar coinciden con el ==primer idioma informado== por el navegador en la cabecera `Accept-Language`.

Esto puede ajustarse en la configuraci√≥n de preferencias del navegador. Adem√°s, si no oculta su direcci√≥n IP, informa a los clientes usuarios sobre su geolocalizaci√≥n a nivel de pa√≠s.

En teor√≠a, podr√≠a segmentarme por ser un hablante de alem√°n residente en Espa√±a y mostrar un contenido muy espec√≠fico para ese caso de uso, siempre que comparta esa informaci√≥n con mi navegador. ¬øVerdad?

Puedes ver qu√© valores est√°n configurados en las herramientas de desarrollo mirando la pesta√±a de "network". Mis diferentes navegadores muestran diferentes preferencias, pero Chrome me da esto:

```html
accept-language: en-GB,en;q=0.9,es-ES;q=0.8,es;q=0.7,de-DE;q=0.6,de;q=0.5,en-US;q=0.4
```

Como puedes ver, dirigirse a la gente bas√°ndose en estos indicadores no es una buena idea.
Mi idioma preferido es el ingl√©s (brit√°nico).

{% aside %}El idioma preferido va seguido de la _sintaxis de valor de calidad_ (`q=0.x`). [M√°s informaci√≥n en MDN.](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Accept-Language)
{% endaside %}

En nuestro proyecto, adem√°s de proporcionar una manera f√°cil para que los usuarios cambien a su idioma preferido real, queremos siempre volver por defecto a un idioma base (en caso de que el idioma preferido del los visitantes se establezca en franc√©s, por ejemplo).

## Estableciendo reglas de redirecci√≥n con Netlify

En el √°mbito de nuestro proyecto de ejemplo estamos trabajando con [Netlify Hosting](https://www.netlify.com/).

Netlify provee una implementaci√≥n directa para las reglas de redirecci√≥n, ya sea usando el archivo `_redirects`, o el archivo de configuraci√≥n de Netlify.

Personalmente, prefiero utilizar el archivo `_redirects` s√≥lo para [redirecciones internas automatizadas](https://eleventy-excellent.netlify.app/blog/post-with-301-redirects/) cuando una p√°gina ha cambiado permanentemente de ubicaci√≥n (alg√∫n tipo de separaci√≥n de preocupaciones).

Dado que creo un archivo de configuraci√≥n de Netlify (`netlify.toml`) de todos modos para informar cu√°l es mi directorio de salida y cu√°l es mi script de construcci√≥n, pongo mis tres redirecciones basadas en el idioma all√≠ tambi√©n. ¬°Tambi√©n me gusta la sintaxis limpia!

`netlify.toml`:

<!-- prettier-ignore -->
```md
# tell netlify about your build script and output directory

[build]
  command = "npm run build"
  publish = "dist"

# redirect to english, spanish or german landing pages

[[redirects]]
  from = "/"
  to = "/de"
  status = 302
  force= true
  conditions = {Language = ["de"]}

[[redirects]]
  from = "/"
  to = "/es"
  status = 302
  force = true
  conditions = {Language = ["es"]}

[[redirects]]
  from = "/"
  to = "/en"
  status = 302
  force = true

```

Redirigimos el directorio ra√≠z en funci√≥n del idioma preferido, el que aparece en primer lugar en el _string_ de cabecera `Accept-Language` (`conditions = {Language = ["de"]}`). Se trata de un array, por lo que puede establecer varios valores.

Establece tantas redirecciones como idiomas hayas creado. El √∫ltimo debe ser el idioma alternativo, es decir, el idioma que has establecido como `defaultLanguage` en el i18n-Plugin.

{% aside %}Puedes [leer m√°s sobre esto en los documentos de Netlify](https://docs.netlify.com/routing/redirects/), como qu√© c√≥digos de estado HTTP tienen qu√© efecto, o c√≥mo crear y redirigir correctamente p√°ginas de error 404 para todos los idiomas. Tambi√©n hay un [cap√≠tulo espec√≠fico para esto dentro de la serie de v√≠deos Jamstack Explorers](https://explorers.netlify.com/learn/exploring-netlify-redirects/localization-with-conditional-redirects).{% endaside %}

## Notas finales

¬°El proyecto est√° listo para ser desplegado!

Mi forma preferida de hacerlo es crear un [nuevo repositorio en GitHub](https://docs.github.com/en/get-started/quickstart/create-a-repo) y [desplegarlo en Netlify](https://www.youtube.com/watch?v=4h8B080Mv4U).

Todav√≠a faltan muchas cosas. Por ejemplo, podr√≠as necesitar colecciones localizadas y un filtro de fecha localizado para tu blog.

He querido mantener este starter lo m√°s simple y directo posible. Puedes refinar y automatizar muchos procesos, ya sea la navegaci√≥n, los permalinks, o las subp√°ginas de los respectivos idiomas, que pueden ser asignados entre s√≠ con claves en el frontmatter, en lugar de utilizar el mismo nombre de carpeta.

Lamentablemente, el CSS no tiene cabida en este art√≠culo. Por todos los medios, por favor reemplace la hoja de estilos CDN con la suya propia, s√≥lo sirve para dar una apariencia razonablemente agradable sin tener que establecer clases.

### Menci√≥n honor√≠fica CSS

La pseudo-clase `:lang` empareja elementos bas√°ndose en el idioma en el que se determina que est√°n. Una buena forma de dar un toque creativo a tus idiomas.

```css
nav:lang(de) {
  background-color: darkseagreen;
}
```

_Logical properties_ proporcionan soporte autom√°tico para la internacionalizaci√≥n y te ayudan a construir frontends estables e inclusivos. Recomiendo leer [el cap√≠tulo sobre el tema en el curso Aprende CSS en web.dev](https://web.dev/learn/css/logical-properties/).

```css
.element {
  padding-block-start: 2em;
  padding-block-end: 2em;
}
```

### Bifurcar el repositorio

Puedes [bifurcar el repo](https://github.com/madrilene/eleventy-i18n) que cre√© junto con el art√≠culo. He a√±adido algunas caracter√≠sticas extra, como un script de ayuda para indicar la p√°gina actual a los lectores de pantalla, redirecciones a p√°ginas 404 localizadas y strings de datos globales para mejorar la accesibilidad (etiquetas aria traducidas, skip-link..). Para evitar el bloqueo de renderizado, he inlineado el CSS minificado despu√©s de eliminar los estilos que no se utilizan.

Me encantar√≠a que se a√±adieran m√°s idiomas. Aqu√≠ tienes una [explicaci√≥n de c√≥mo contribuir a los proyectos](https://docs.github.com/en/get-started/quickstart/contributing-to-projects). A√±ade una nueva carpeta con tu localizaci√≥n en `src`, y crea los archivos de plantilla correspondientes en tu idioma. A√±ade el array de navegaci√≥n a `navigation.js`, los _strings_ localizados a `languages.js` y a√±ade las redirecciones a `netlify.toml`.

Por √∫ltimo, una peque√±a disculpa: S√≥lo puedo expresarme en t√©rminos ingleses y nunca he le√≠do un libro de referencia en espa√±ol sobre tecnolog√≠as web. Utilic√© muchas frases extra√±as en pseudoespa√±ol o ni siquiera intent√© traducir algunos t√©rminos.

### Algunos enlaces relacionados con el tema

- [YouTube: Internationalization (i18n), Eleventy üéà Weekly ‚Ññ16](https://youtube.com/watch?v=sfPNgt3joWI&t=1122)
- [Smashing Magazine: I18n And l10n For Static Sites](https://www.smashingmagazine.com/2020/11/internationalization-localization-static-sites/)
- [benmyers.dev: I Finally Understand Eleventy's Data Cascade](https://benmyers.dev/blog/eleventy-data-cascade/)
- [hoeser.dev: I18n of URLs](https://www.hoeser.dev/blog/2022-07-08-i18n-urls/)
- [YouTube: How a screen reader sounds without "lang" attribute defined](https://www.youtube.com/watch?v=QwOoU8T24UY)
- [w3.org: Language information and text direction](https://www.w3.org/TR/REC-html40/struct/dirlang.html)
